<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>New Student</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
}

input, select {
  width: 100%;
  padding: 8px;
  margin: 6px 0 12px 0;
  box-sizing: border-box;
}

button {
  padding: 10px 20px;
  cursor: pointer;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 40px;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
}
</style>
</head>
<body>

<h2>New Student</h2>

<label>Parent</label>
<select id="parent_id">
  <option value="">Select Parent</option>
</select>

<label>Student Name</label>
<input type="text" id="name">

<label>Date of Birth</label>
<input type="date" id="date_of_birth">

<label>Grade</label>
<input type="text" id="grade">

<h3>Authorized Pickup 1</h3>
<label>Name</label>
<input type="text" id="ap1_name">
<label>Phone</label>
<input type="text" id="ap1_phone">
<label>Relationship</label>
<input type="text" id="ap1_relationship">

<h3>Authorized Pickup 2</h3>
<label>Name</label>
<input type="text" id="ap2_name">
<label>Phone</label>
<input type="text" id="ap2_phone">
<label>Relationship</label>
<input type="text" id="ap2_relationship">

<h3>Authorized Pickup 3</h3>
<label>Name</label>
<input type="text" id="ap3_name">
<label>Phone</label>
<input type="text" id="ap3_phone">
<label>Relationship</label>
<input type="text" id="ap3_relationship">

<h3>Emergency Contact</h3>
<label>Name</label>
<input type="text" id="ec_name">
<label>Phone</label>
<input type="text" id="ec_phone">
<label>Relationship</label>
<input type="text" id="ec_relationship">

<label>Active</label>
<select id="is_active">
  <option value="true">Active</option>
  <option value="false">Inactive</option>
</select>

<button id="saveStudent">Save Student</button>

<table id="studentTable">
<thead>
<tr>
  <th>ID</th>
  <th>Name</th>
  <th>Parent</th>
  <th>DOB</th>
  <th>Grade</th>
  <th>Active</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
// -----------------------
// LOAD PARENTS
// -----------------------
async function loadParents() {
  try {
    const res = await fetch("https://x8ki-letl-twmt.n7.xano.io/api:iEHfqd-N/parent");
    const parents = await res.json();

    const dropdown = document.getElementById("parent_id");
    dropdown.innerHTML = '<option value="">Select Parent</option>';

    parents.forEach(p => {
      const opt = document.createElement("option");
      opt.value = p.id;
      opt.textContent = `${p.first_name} ${p.last_name}`;
      dropdown.appendChild(opt);
    });
  } catch (err) {
    console.error("Error loading parents:", err);
  }
}

// -----------------------
// LOAD STUDENTS
// -----------------------
async function loadStudents() {
  try {
    const res = await fetch("https://x8ki-letl-twmt.n7.xano.io/api:iEHfqd-N/student");
    const students = await res.json();

    const tableBody = document.querySelector("#studentTable tbody");
    tableBody.innerHTML = "";

    students.forEach(s => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${s.id}</td>
        <td>${s.name}</td>
        <td>${s.parent_id}</td>
        <td>${s.date_of_birth}</td>
        <td>${s.grade}</td>
        <td>${s.is_active}</td>
      `;
      tableBody.appendChild(row);
    });
  } catch (err) {
    console.error("Error loading students:", err);
  }
}

// -----------------------
// SAVE STUDENT
// -----------------------
document.getElementById("saveStudent").addEventListener("click", async () => {
  const payload = {
    parent_id: Number(document.getElementById("parent_id").value),
    name: document.getElementById("name").value,
    date_of_birth: document.getElementById("date_of_birth").value,
    grade: document.getElementById("grade").value,
    authorized_pickup_1_name: document.getElementById("ap1_name").value,
    authorized_pickup_1_phone: document.getElementById("ap1_phone").value,
    authorized_pickup_1_relationship: document.getElementById("ap1_relationship").value,
    authorized_pickup_2_name: document.getElementById("ap2_name").value,
    authorized_pickup_2_phone: document.getElementById("ap2_phone").value,
    authorized_pickup_2_relationship: document.getElementById("ap2_relationship").value,
    authorized_pickup_3_name: document.getElementById("ap3_name").value,
    authorized_pickup_3_phone: document.getElementById("ap3_phone").value,
    authorized_pickup_3_relationship: document.getElementById("ap3_relationship").value,
    emergency_contact_name: document.getElementById("ec_name").value,
    emergency_contact_phone: document.getElementById("ec_phone").value,
    emergency_contact_relationship: document.getElementById("ec_relationship").value,
    is_active: document.getElementById("is_active").value === "true"
  };

  try {
    await fetch("https://x8ki-letl-twmt.n7.xano.io/api:iEHfqd-N/student", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    loadStudents();
    alert("Student Saved!");
  } catch (err) {
    console.error("Save error:", err);
  }
});

// INITIAL LOAD
loadParents();
loadStudents();
</script>

</body>
</html>

